# Effects of different compounds on C.elegans offspring


```{r data inladen, warning = F, results = "hide", message=F}

library(tidyverse)
library(readxl)
library(here)


data <- read_excel(here(path = "Data/CE.LIQ.FLOW.062_Tidydata.xlsx"))

#checken datatypes van de variabelen 
str(data)
```


Na checken van de datatypen van RawData, compName en compConcentration hebben deze respectievelijk numeric, character en character als datatype. compConcentration zou numeric moeten zijn. Anders zou de plot er als volgt uit zien:



```{r eerste plot, warning = F}
data %>% ggplot(aes(x = compConcentration, y = RawData, colour = compName, shape = expType)) + geom_point() +
theme_bw() + theme(axis.text.x = element_text(angle = 90)) 
```


Omdat de variabele compConcentration als character staat wordt deze niet in de juiste volgorde geplot. 


```{r plot datatypes aangepast, warning = F}
#aanpassen datatypes
data$compName <- as.factor(data$compName)
data$compConcentration <- as.numeric(data$compConcentration)


#data iets makkelijker leesbaar maken door beperkt aantal kolommen mee te nemen
data2 <- data %>% select(vialNr, dropCode, expType, expReplicate, RawData, compName, compConcentration, compUnit, compVehicle)


#log10 van compConcentration en geom_jitter en geom_smooth zodat de plot iets duidelijker te volgen is.
data2 %>% ggplot(aes(x = log10(compConcentration), y = RawData, colour = compName, shape = expType)) + 
theme_bw() + geom_jitter(width = 0.2) +
labs(title = "Offspring C. elegans after incubation with decane, napthalene, \n2,6-diisopropylnapthalene, S-medium or ethanol",
     x = "Log10 concentration component",
     y = "Offspring amount")

```

Vergeleken met de vorige plot is hier de variabele compConcentration wel omgezet in numeric (en ook log10 van genomen). Verder is ook geom_jitter gebruikt zodat datapunten niet zoveel overlappen met elkaar. 

De positieve controle voor dit experiment is ethanol, de negatieve controle voor dit experiment is S-medium.





```{r plot genormaliseerd, warning = F, message = F}

#Neem de gemmiddelde nakomelingen per middel, per concentratie. 
summary_data <- data2 %>% group_by(compName, compConcentration,expType) %>% summarise(gem = mean(RawData, na.rm = T))



#Verkrijg de gemiddelde offspring count van de negatieve controle
nc_gem <- summary_data$gem[summary_data$expType == "controlNegative"]


#Maak een nieuwe kolom aan waarbij er genormaliseerd wordt door de fractie te nemen ten opzichte van de negatieve controle, waarbij de nc gelijk staat aan 1.0 
summary_data <- summary_data %>% mutate(fractie = gem/nc_gem)

#filter zodat positieve/negatieve controles niet geplot worden
summary_plotting <- summary_data %>% filter(compName == "decane" | compName == "2,6-diisopropylnaphthalene" | compName == "naphthalene")


summary_plotting %>% ggplot(aes(x = log10(compConcentration), y = fractie, colour = compName)) +
  geom_point() + geom_smooth() + theme_bw() + ylim(0,1.3) + labs(title = "Offspring C. elegans after treatment with decane, napthalene \nor 2,6-diisopropylnaphthalene",
                                                                 x = "Log10 component concentration",
                                                                 y = "Fraction offspring (relative to, negative control)") + guides(color = guide_legend("Component")) + scale_colour_manual(values = c("red","blue","darkgreen"))


```



In deze plot is de data genormaliseerd ten opzichte van de negatieve controle (S-medium), waarbij de nakomelingen van C.elegans die voort zijn gekomen uit de incubatie met S-medium gelijk staat aan 1.0

Er is genormaliseerd zodat de verschillende stoffen makkelijker vergeleken kunnen worden met de negatieve controle, waarvan je weet dat het geen effect zou moeten hebben. 

Als er gekeken zou worden of er daadwerkelijk een statistisch significant verschil is tussen de compounds en de offspring count in C elegans zouden de volgende stappen worden uitgevoerd:

1: Shapiro wilk test op de verschillende groepen, om te kijken of de data normaal verdeeld is

2: Als data normaal verdeeld is, ook not een Levene's test uitvoeren omdat het ontwerp van het experiment ongepaard is. 

3: Daarna kunnen ook ongepaarde t-tests worden gedaan.







<!-- ```{r plots apart, warning = F} -->

<!-- library(ggpubr) -->



<!-- decane_data <- summary_data %>% filter(compName == "decane") -->
<!-- ic50_decane <- ((max(decane_data$gem) - min(decane_data$gem))/2) + min(decane_data$gem) -->




<!-- decane_plot <- decane_data %>% ggplot(aes(x = log10(compConcentration), y = gem)) + -->
<!-- geom_point(colour = "blue") + theme_bw() + geom_hline(yintercept = ic50_decane, linetype = "dashed") + guides(color = F) + geom_smooth(colour = "blue") + ylim(0,100) + labs(x = "Log10(Decane) (nM)", -->
<!--                                                                       y = "Offspring") -->


<!-- naph_data <- summary_data %>% filter(compName == "naphthalene") -->
<!-- ic50_naph <- ((max(naph_data$gem) - min(naph_data$gem))/2) + min(naph_data$gem) -->

<!-- naph_plot <- naph_data %>% ggplot(aes(x = log10(compConcentration), y = gem)) + -->
<!-- geom_point(colour = "darkgreen") + geom_hline(yintercept = ic50_naph, linetype = "dashed") + guides(color = F) + geom_smooth(colour = "darkgreen") + ylim(0,100) + theme_bw() + labs(x = "Log10(Naphthalene) (nM)", -->
<!--                                                                       y = "Offspring") -->


<!-- diiso_data <- summary_data %>% filter(compName == "2,6-diisopropylnaphthalene") -->
<!-- ic50_diiso <- ((max(diiso_data$gem) - min(diiso_data$gem))/2) + min(diiso_data$gem) -->

<!-- diiso_plot <- diiso_data %>% ggplot(aes(x = log10(compConcentration), y = gem)) + -->
<!-- geom_point(colour = "red") + theme_bw() + geom_hline(yintercept = ic50_diiso, linetype = "dashed") + guides(color = F) + geom_smooth(colour = "red") + ylim(0,100) + labs(x = "Log10(2,6-diisopropylnaphthalene) (nM) ", -->
<!--                                                                       y = "Offspring") -->


<!-- library(ggpubr) -->

<!-- ggarrange(decane_plot, naph_plot,diiso_plot, labels="AUTO") -->


<!-- ``` -->


